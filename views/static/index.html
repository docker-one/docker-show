<!doctype html>
<html class="x-admin-sm">
    <head>
        <meta charset="UTF-8">
        <title>Docker Show</title>
        <meta name="renderer" content="webkit|ie-comp|ie-stand">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="icon" href="favicon.ico" mce_href="favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
         <link rel="stylesheet" href="./css/theme5.css">
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
        <script type="text/javascript" src="./js/jquery.min.js"></script>

        <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
        <!--[if lt IE 9]>
          <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
          <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        <script>
            // 是否开启刷新记忆tab功能
            // var is_remember = false;
            $(function () {
               if(localStorage.getItem("username")==null||localStorage.getItem("username")==''){
                   //debugger;
                   //location.href='login.html';
                   //top.location.href ="login.html"; //这种可以新页打开
                   //window.parent.location.replace("login.html");//刷新父级页面; 这种可以新页打开
               }
            })
        </script>
        <script src="data/sensor.js"></script>
        <link rel="stylesheet" href="lib/layui/css/layui.css">
    </head>
    <body class="index" style="background-color: white;">
        <!-- 顶部开始 -->
        <div class="container">
            <div class="logo">
<!--    小保当瓦斯巡检机器人系统     小保当瓦斯巡检机器人操作系统       小保当瓦斯巡检机器人检测模块系统-->
                <a id="mainPageTitle" href="./index.html">瓦斯巡检机器人系统</a></div>
            <div class="left_open">
                <a><i title="展开左侧栏" class="iconfont">&#xe699;</i></a>
            </div>
            <ul class="layui-nav left fast-add" lay-filter="">
<!--                <li class="layui-nav-item">-->
<!--                    <a href="javascript:;">+新增</a>-->
<!--                    <dl class="layui-nav-child">-->
<!--                        &lt;!&ndash; 二级菜单 &ndash;&gt;-->
<!--                        <dd>-->
<!--                            <a onclick="xadmin.open('最大化','http://www.baidu.com','','',true)">-->
<!--                                <i class="iconfont">&#xe6a2;</i>弹出最大化</a></dd>-->
<!--                        <dd>-->
<!--                            <a onclick="xadmin.open('弹出自动宽高','http://www.baidu.com')">-->
<!--                                <i class="iconfont">&#xe6a8;</i>弹出自动宽高</a></dd>-->
<!--                        <dd>-->
<!--                            <a onclick="xadmin.open('弹出指定宽高','http://www.baidu.com',500,300)">-->
<!--                                <i class="iconfont">&#xe6a8;</i>弹出指定宽高</a></dd>-->
<!--                        <dd>-->
<!--                            <a onclick="xadmin.add_tab('在tab打开','member-list.html')">-->
<!--                                <i class="iconfont">&#xe6b8;</i>在tab打开</a></dd>-->
<!--                        <dd>-->
<!--                            <a onclick="xadmin.add_tab('在tab打开刷新','member-del.html',true)">-->
<!--                                <i class="iconfont">&#xe6b8;</i>在tab打开刷新</a></dd>-->
<!--                    </dl>-->
<!--                </li>-->
            </ul>
            <ul class="layui-nav right" lay-filter="">
                <li class="layui-nav-item">            <h1 style="font-size: 24px;" id="a_title"></h1></li>
                <li class="layui-nav-item">
                    <a href="javascript:;" id="login_userName">admin</a>
                    <dl class="layui-nav-child">
                        <!-- 二级菜单 -->
                        <dd>
                            <a onclick="xadmin.open('个人信息','about.html')">个人信息</a></dd>
                        <dd>
<!--                            <a onclick="xadmin.open('切换帐号','http://www.baidu.com')">切换帐号</a></dd>-->
                        <dd>
                            <a href="./login.html" onclick="quitRotbot()">退出</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item to-index">
                    <a href="#" onclick="openOneMap()">大数据一张图</a></li>
            </ul>
        </div>
        <!-- 顶部结束 -->
        <!-- 中部开始 -->
        <!-- 左侧菜单开始 -->
        <div class="left-nav">
            <div id="side-nav">
                <ul id="nav">
                    <li>
                        <a href="javascript:;">
                            <i class="iconfont left-nav-li" lay-tips="数据管理">&#xe6b8;</i>
                            <cite>数据管理</cite>
                            <i class="iconfont nav_right">&#xe697;</i></a>
                        <ul class="sub-menu">
                            <li>
                                <a onclick="xadmin.add_tab('数据管理(传感器管理)','imagesList.html',true)">
                                    <i class="iconfont">&#xe6a7;</i>
                                    <cite>Images</cite></a>
                            </li>
                            <li>
                                <a onclick="xadmin.add_tab('数据管理(LED管理)','containersList.html',true)">
                                    <i class="iconfont">&#xe6a7;</i>
                                    <cite>Containers</cite></a>
                            </li>

                        </ul>
                    </li>
                    <li>
                        <a href="javascript:;">
                            <i class="iconfont left-nav-li" lay-tips="统计报表">&#xe723;</i>
                            <cite>统计报表</cite>
                            <i class="iconfont nav_right">&#xe697;</i></a>
                        <ul class="sub-menu">
                            <li>
                                <a onclick="xadmin.add_tab('统计信息','sensorChartByHour.html')">
                                    <i class="iconfont">&#xe6a7;</i>
                                    <cite>统计信息</cite></a>
                            </li>

                        </ul>
                    </li>
                    <li>
                        <a href="javascript:;">
                            <i class="iconfont left-nav-li" lay-tips="日志管理">&#xe723;</i>
                            <cite>日志管理</cite>
                            <i class="iconfont nav_right">&#xe697;</i></a>
                        <ul class="sub-menu">
                            <li>
                                <a onclick="xadmin.add_tab('断网统计','logNetworkListGather.html')">
                                    <i class="iconfont">&#xe6a7;</i>
                                    <cite>断网统计</cite></a>
                            </li>
                            <li>
                                <a onclick="xadmin.add_tab('网络日志','logNetworkList.html')">
                                    <i class="iconfont">&#xe6a7;</i>
                                    <cite>网络日志</cite></a>
                            </li>

<!--                            <li>-->
<!--                                <a onclick="xadmin.add_tab('校准日志','logSetGasList.html')">-->
<!--                                    <i class="iconfont">&#xe6a7;</i>-->
<!--                                    <cite>校准日志</cite></a>-->
<!--                            </li>-->

<!--                            <li>-->
<!--                                <a onclick="xadmin.add_tab('报表信息','reportList.html')">-->
<!--                                    <i class="iconfont">&#xe6a7;</i>-->
<!--                                    <cite>报表信息</cite></a>-->
<!--                            </li>-->
                        </ul>
                    </li>
                    <li id="sys_settingMeun">
                        <a href="javascript:;">
                            <i class="layui-icon layui-icon-set" lay-tips="系统设置"></i>
                            <cite>系统设置</cite>
                            <i class="iconfont nav_right">&#xe697;</i></a>
                        <ul class="sub-menu">
                            <li>
                                <a onclick="xadmin.add_tab('系统设置','settings.html')">
                                    <i class="iconfont">&#xe6a7;</i>
                                    <cite>系统设置</cite></a>
                            </li>


                            <li style="">
                                <a href="javascript:;">
                                    <i class="iconfont">&#xe70b;</i>
                                    <cite>报表审阅管理</cite>
                                    <i class="iconfont nav_right">&#xe697;</i></a>
                                <ul class="sub-menu">
                                    <li>
                                        <a onclick="xadmin.add_tab('审批人管理','approve_accountList.html')">
                                            <i class="iconfont">&#xe6a7;</i>
                                            <cite>审批人管理</cite></a>
                                    </li>
                                    <li>
                                        <a onclick="xadmin.add_tab('审批日志','approve_logList.html')">
                                            <i class="iconfont">&#xe6a7;</i>
                                            <cite>审批日志</cite></a>
                                    </li>
                                </ul>
                            </li>


<!--                            <li>-->
<!--                                <a onclick="xadmin.add_tab('设置一张图','settings_map.html')">-->
<!--                                    <i class="iconfont">&#xe6a7;</i>-->
<!--                                    <cite>设置一张图</cite></a>-->
<!--                            </li>-->
<!--                            <li>-->
<!--                                <a onclick="xadmin.add_tab('媒体发布','./ueditor/index.html')">-->
<!--                                    <i class="iconfont">&#xe6a7;</i>-->
<!--                                    <cite>媒体发布</cite></a>-->
<!--                            </li>-->
                        </ul>
                    </li>

                </ul>
            </div>
        </div>
        <!-- <div class="x-slide_left"></div> -->
        <!-- 左侧菜单结束 -->
        <!-- 右侧主体开始 -->
        <div class="page-content">
            <div class="layui-tab tab" lay-filter="xbs_tab" lay-allowclose="false">
                <ul class="layui-tab-title">
                    <li class="home">
                        <i class="layui-icon">&#xe68e;</i>我的桌面</li></ul>
                <div class="layui-unselect layui-form-select layui-form-selected" id="tab_right">
                    <dl>
                        <dd data-type="this">关闭当前</dd>
                        <dd data-type="other">关闭其它</dd>
                        <dd data-type="all">关闭全部</dd></dl>
                </div>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">
                        <iframe src='./sensorList.html' frameborder="0" scrolling="yes" class="x-iframe"></iframe>
                    </div>
                </div>
                <div id="tab_show"></div>
            </div>
        </div>
        <div class="page-content-bg"></div>
        <style id="theme_style"></style>
    </body>
<script type="text/javascript">
    $(function () {
        // let loginUser=JSON.parse(localStorage.getItem("robotUser"));
        // if(loginUser==null){
        //     location.href='login.html';
        //     return;
        // }
        // let username=loginUser.username;
        // $("#login_userName").html(username);
        // setTitle();
        // //如果不是管理员
        // if(!sensorServer.getRoleIsAdmin()){
        //     $("#sys_settingMeun").hide();
        // }
    })
    //打开一张图首页
    function openOneMap(){
        let postData={"appkey":"map_home_url"};
        let svgInfo=sensorServer.getSettingsByAppKey(postData);
        if(svgInfo!=null&&svgInfo.appval!=undefined&&svgInfo.appval!=null){
            let homeUrl=svgInfo.appval;
            window.open(homeUrl,"_blank");
        }else{
            layer.msg('请设置一张图数据主页后,重试!',{icon:1,time:1000});
        }
    }
    function setTitle() {

        let postData={"appkey":"mine_name"};
        let svgInfo=sensorServer.getSettingsByAppKey(postData);
        if(svgInfo==null||svgInfo.appval==""){
            console.log("未设置矿名称！");
            setMineNameAlert();
            return;
        }
        if(svgInfo.appval!=undefined&&svgInfo.appval!=null){
            let mine_name=svgInfo.appval;
            if(mine_name!=""&&mine_name!=null) {
                $("#a_title").html(mine_name);
                // debugger;
                // if(sensorServer.getLoginUserInfo().minesId!=0){
                //       if(sensorServer.getLoginUserInfo().mineName!=""){
                //           $("#a_title").html(sensorServer.getLoginUserInfo().mineName);
                //       }
                // }
            }
        }
    }
    function quitRotbot() {
         localStorage.removeItem("robotUser");
         localStorage.clear();
    }

    function setMineNameAlert(){
        xadmin.open('初始设置','setMineName.html',500,400);
    }

</script>
<script type="text/javascript">

    //检测是否有超限
    $(function () {
        //$("#mainPageTitle").html(document.title);
        //setInterval(CycleTest,10000);
    });

    function CycleTest() {

        var sensorList=sensorServer.getSensorList({"page":1,"rows":1000});
        var overrunList=sensorServer.getMaxSetting({"page":1,"rows":1000});
        let overrunInfo=overrunList.data[0];
        let showMsg="";
        for (let i=0;i<sensorList.data.length;i++){
             let sensorInfo=sensorList.data[i];
             let tempMsg="";
             if(sensorInfo.ch4>overrunInfo.ch4){
                 tempMsg+="CH4:"+sensorInfo.ch4+"<br>";
             }
            if(sensorInfo.co2>overrunInfo.co2){
                tempMsg+="CO2:"+sensorInfo.co2+"<br>";
            }
            if(sensorInfo.co>overrunInfo.co){
                tempMsg+="CO:"+sensorInfo.co+"<br>";
            }
            if(sensorInfo.temperature>overrunInfo.temperature){
                tempMsg+="温度:"+sensorInfo.temperature+"<br>";
            }
            if(sensorInfo.o2<overrunInfo.o2){
                tempMsg+="O2:"+sensorInfo.o2+"<br>";
            }
            if(tempMsg!="") {
                showMsg += sensorInfo.devicelocation+" "+tempMsg;

            }
        }
        showOverRunMsg(showMsg);
        playAudioMsg(showMsg); //播放报警语音
    }
    function  showOverRunMsg(msg) {
        if(msg=="")
            return;
        let text=msg;
        layer.open({
            type: 1
            ,title: "超限消息"
            ,offset: "rb" //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
            ,id: 'layerDemo1' //防止重复弹出
            ,content: text  //弹出网页 ,content: 'http://www.baidu.com' 上边的type 设置为2即可
            ,btn: '关闭全部'
            ,btnAlign: 'c' //按钮居中
            ,shade: 0 //不显示遮罩
            ,area: ['400px']
            ,yes: function(){
                layer.closeAll();
            }
        });
        $("#layerDemo1").html(text);
    }

    function playAudioMsg(msg){
        //debugger;
        let lastPlayAudioTime=localStorage.getItem("lastPlayAudio");
        if(lastPlayAudioTime!=null){
           let nowTime=parseInt(new Date().getTime()/1000);
           let lastTime=parseInt(lastPlayAudioTime);
           let chav=nowTime-lastTime;
            console.log('据上次播报差：'+chav);
            let chaMin=getweb_play_audio_interval();
            if(chav<chaMin){
               return ;
            }
            console.log('-----播报一次：'+chav);
        }

        let msgText=msg.replaceAll("CH4","甲烷")
                       .replaceAll("CO2","二氧化碳")
                       .replaceAll("O2","氧气");
        msgText=msgText.replaceAll("CO","一氧化碳")
        console.log(msgText);
        var u = new SpeechSynthesisUtterance();
        u.text = msgText; //"你好。我要播放语音了。。。";
        u.lang = 'zh';
        //u.rate = 0.7   volume
        speechSynthesis.speak(u);

        //记录下最后的播放时间，用于设置播报间隔
        localStorage.setItem("lastPlayAudio",parseInt(new Date().getTime()/1000));
    }

    //换算成秒数
    function getweb_play_audio_interval(){
        let postData={"appkey":"web_play_audio_interval"};
        let settingsInfo=sensorServer.getSettingsByAppKey(postData);
        if(settingsInfo!=undefined&&settingsInfo!=null){
            if(settingsInfo.appval!=undefined&&settingsInfo.appval!=null) {
                return parseInt(settingsInfo.appval)*60;
            }
        }
        return  1*60;
    }

</script>

</html>
